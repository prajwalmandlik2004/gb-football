<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Bet</title>
    <link rel="stylesheet" href="./css/bet.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <img src="/images/football_two.png" alt="GB Football Logo" class="logo">
            <h1 class="site-name">GB FOOTBALL</h1>
        </header>
        <h3>Place Your Bet</h3>
        <form id="betForm" action="/bet" method="POST">
            <div class="form-group">
                <p>Account Balance: {{totalBalance}}</p>
                <label for="userId">User ID (GBXXXX):</label>
                <input type="text" id="userId" name="userId" required>
            </div>
            <p id="profitDisplay">Profit : </p>
            <button type="button" id="betAllButton" class="btn" onclick="alert('Wait some time to place your bet âœ…')">Bet All</button>
            <p id="betMessage" style="color: red; display: none;"></p>
        </form>
    </div>
    <script>
        const profitRates = {
            1: 2.10,
            2: 2.20,
            3: 2.05,
            4: 2.05,
            5: 2.10,
            6: 2.05,
            0: 0.00 // Sunday is off
        };

        const totalBalance = {{ totalBalance }};
        const today = new Date().getDay();
        const profitRate = profitRates[today];

        if (profitRate === 0) {
            document.getElementById('profitDisplay').innerText = 'Today is off. No betting allowed.';
            document.getElementById('betAllButton').disabled = true;
        } else {
            const profit = (totalBalance * profitRate / 100).toFixed(2);
            document.getElementById('profitDisplay').innerText = `Profit: ${profit}`;
        }

        document.getElementById('betAllButton').addEventListener('click', async () => {
            if (totalBalance === 0) {
                alert('No account balance. Please deposit first.');
            } else if (profitRate !== 0) {
                try {
                    const userId = document.getElementById('userId').value;
                    const response = await fetch('/bet', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ userId }),
                    });

                    const result = await response.json();

                    if (response.ok && result.message === 'success') {
                        alert('Your bet has been successfully placed.âœ…');
                        window.location.href = '/bet'; // Redirect to the bet page
                    } else {
                        document.getElementById('betMessage').innerText = 'You can only place one bet in each time slot in a day. ðŸ›‘';
                        document.getElementById('betMessage').style.display = 'block';
                        document.getElementById('betAllButton').disabled = true;
                    }
                } catch (error) {
                    console.error('Error during bet:', error);
                    alert('An error occurred. Please try again.');
                }
            }
        });
    </script>
</body>

</html>

